# 登录功能修复说明

## 问题原因

原来使用的是BCrypt加密密码，导致密码验证失败。现已改为明文密码存储，简化登录流程。

## 已修改的文件

### 1. 数据库脚本
- **文件**: `database/init.sql`
- **修改**: 将插入语句中的BCrypt密码hash改为明文密码
  - admin: `admin123`
  - user: `user123`

### 2. 后端代码
- **文件**: `backend/user-service/src/main/java/com/smartoffice/user/service/UserService.java`
- **修改内容**:
  - 删除了 `BCryptPasswordEncoder` 的引用
  - 将密码验证从 `passwordEncoder.matches()` 改为 `password.equals()`

## 如何修复现有数据库

### 方法1：执行SQL更新脚本（推荐）

在MySQL中执行以下SQL语句：

```sql
USE smart_office;

-- 更新管理员密码
UPDATE user_info SET password = 'admin123' WHERE username = 'admin';

-- 更新普通用户密码
UPDATE user_info SET password = 'user123' WHERE username = 'user';

-- 验证结果
SELECT id, username, password, role FROM user_info;
```

或者直接执行SQL文件：
```bash
mysql -u root -p123456 smart_office < database/update_password.sql
```

### 方法2：重新初始化数据库

如果数据库中没有重要数据，可以重新初始化：

```bash
# 删除旧数据库
mysql -u root -p123456 -e "DROP DATABASE IF EXISTS smart_office;"

# 重新执行初始化脚本
mysql -u root -p123456 < database/init.sql
```

## 重启服务

修改完成后，重启user-service：

```bash
cd backend/user-service
mvn clean
mvn spring-boot:run
```

## 测试登录

使用以下账号测试登录：

- **管理员**:
  - 用户名: `admin`
  - 密码: `admin123`

- **普通用户**:
  - 用户名: `user`
  - 密码: `user123`

## 注意事项

⚠️ **安全提示**: 明文密码仅适用于学习和演示环境，生产环境请务必使用加密存储！
