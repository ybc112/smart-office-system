# 🚀 快速启动指南

## 问题说明

如果您在 Windows 命令提示符中运行 `mvn spring-boot:run` 遇到依赖找不到的错误，这是因为：
- 项目在 WSL/Linux 环境中构建（依赖安装在 `/root/.m2/repository`）
- Windows 的 Maven 使用不同的仓库位置（`C:\Users\用户名\.m2\repository`）

**解决方案**：直接运行已经构建好的 JAR 文件！

---

## ✅ 前置条件

确保以下服务已启动：

### 1. MySQL 数据库
```bash
# 检查 MySQL 是否运行
mysql -u root -p -e "SELECT 1"

# 导入数据库（首次运行）
mysql -u root -p < database/init.sql
```

### 2. Redis
```bash
# Windows 启动 Redis
redis-server

# 检查 Redis
redis-cli ping
# 应该返回: PONG
```

### 3. MQTT Broker (Mosquitto)
```bash
# Windows 安装 Mosquitto
winget install EclipseMosquitto

# 启动 Mosquitto 服务
net start mosquitto

# 检查端口 1883 是否开放
netstat -an | findstr 1883
```

---

## 🎯 方式一：使用启动脚本（推荐）

### 启动所有服务
```bash
# 在项目根目录双击运行
start-all-services.bat
```

这将自动启动：
1. Device Service (端口 8081)
2. User Service (端口 8082)

### 单独启动服务
```bash
# 单独启动 device-service
start-device-service.bat

# 单独启动 user-service
start-user-service.bat
```

---

## 🎯 方式二：手动运行 JAR 文件

### 1. 启动 Device Service
```bash
cd E:\java毕设\智慧办公楼系统\backend\device-service\target
java -jar device-service-1.0.0.jar
```

### 2. 启动 User Service（新开一个命令提示符窗口）
```bash
cd E:\java毕设\智慧办公楼系统\backend\user-service\target
java -jar user-service-1.0.0.jar
```

---

## 🎯 方式三：在 Windows 中重新构建（可选）

如果您想使用 `mvn spring-boot:run` 命令，需要在 Windows 中重新构建：

```bash
# 在 Windows 命令提示符中运行
cd E:\java毕设\智慧办公楼系统
build-all.bat
```

这将：
1. 构建 common 模块并安装到 Windows Maven 仓库
2. 构建 device-service
3. 构建 user-service

构建完成后就可以使用：
```bash
cd E:\java毕设\智慧办公楼系统\backend\device-service
mvn spring-boot:run
```

---

## 🌐 启动前端

```bash
cd E:\java毕设\智慧办公楼系统\frontend

# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm run dev
```

---

## ✅ 验证服务启动

### 1. 检查后端服务
```bash
# Device Service
curl http://localhost:8081/actuator/health

# User Service
curl http://localhost:8082/actuator/health
```

### 2. 访问前端
打开浏览器访问: http://localhost:5173

### 3. 登录系统
- 管理员账号: `admin` / `admin123`
- 普通用户: `user` / `user123`

---

## 📍 服务端口

| 服务 | 端口 | 访问地址 |
|------|------|----------|
| 前端 | 5173 | http://localhost:5173 |
| Device Service | 8081 | http://localhost:8081 |
| User Service | 8082 | http://localhost:8082 |
| MySQL | 3306 | localhost:3306 |
| Redis | 6379 | localhost:6379 |
| MQTT | 1883 | tcp://localhost:1883 |

---

## ❗ 常见问题

### 1. 端口被占用
```bash
# 查看端口占用
netstat -ano | findstr "8081"
netstat -ano | findstr "8082"

# 杀掉占用端口的进程
taskkill /PID 进程ID /F
```

### 2. 找不到 JAR 文件
确保已经运行过构建脚本：
```bash
build-all.bat
```

### 3. 数据库连接失败
检查 `application.yml` 中的数据库配置：
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/smart_office
    username: root
    password: your_password  # 修改为您的密码
```

### 4. WebSocket 连接失败
- 确保 device-service 已启动（WebSocket 端点在 8081 端口）
- 检查前端代码中的 WebSocket 地址是否正确

### 5. MQTT 连接失败
```bash
# 检查 Mosquitto 服务状态
sc query mosquitto

# 手动启动
net start mosquitto

# 测试 MQTT 连接
mosquitto_sub -h localhost -t "office/#"
```

---

## 🎉 启动成功标志

当您看到以下日志时，表示服务启动成功：

**Device Service:**
```
Started DeviceServiceApplication in X.XXX seconds
已连接到 MQTT Broker: tcp://localhost:1883
```

**User Service:**
```
Started UserServiceApplication in X.XXX seconds
```

**前端:**
```
VITE v5.x.x  ready in XXX ms
➜  Local:   http://localhost:5173/
```

---

## 📝 下一步

1. ✅ 启动 MySQL、Redis、MQTT Broker
2. ✅ 运行 `start-all-services.bat` 启动后端服务
3. ✅ 在 frontend 目录运行 `npm run dev` 启动前端
4. ✅ 访问 http://localhost:5173 并使用 admin/admin123 登录
5. ✅ 在首页查看设备状态和实时数据
6. ✅ 测试设备控制功能（开关灯、查看告警等）

---

**构建时间**: 2025年10月18日
**推荐启动方式**: 使用 `start-all-services.bat` 脚本
