# å¿«é€Ÿå¯åŠ¨æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©ä½ åœ¨5åˆ†é’Ÿå†…å¯åŠ¨æ•´ä¸ªæ™ºæ…§åŠå…¬æ¥¼ç³»ç»Ÿã€‚

## å‰ç½®æ¡ä»¶

ç¡®ä¿ä½ çš„ç”µè„‘ä¸Šå·²å®‰è£…ï¼š

- âœ… Docker & Docker Compose
- âœ… JDK 1.8+
- âœ… Maven 3.6+
- âœ… Python 3.6+
- âœ… Gitï¼ˆå¯é€‰ï¼‰

## å¯åŠ¨æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨åŸºç¡€è®¾æ–½ï¼ˆMQTTã€MySQLã€Redisï¼‰

```bash
cd docker
docker-compose up -d
```

ç­‰å¾…çº¦30ç§’ï¼Œæ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š
```bash
docker-compose ps
```

åº”è¯¥çœ‹åˆ°3ä¸ªæœåŠ¡éƒ½æ˜¯ `Up` çŠ¶æ€ã€‚

**éªŒè¯**:
- MQTTç®¡ç†ç•Œé¢ï¼šhttp://localhost:18083 (admin/public)
- MySQLï¼šlocalhost:3306 (root/root123)
- Redisï¼šlocalhost:6379 (redis123)

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

**æ–¹å¼1ï¼šä½¿ç”¨Mavenè¿è¡Œï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰**

```bash
# åœ¨æ–°ç»ˆç«¯çª—å£ä¸­è¿è¡Œ
cd backend/device-service
mvn clean spring-boot:run
```

ç­‰å¾…çœ‹åˆ° `è®¾å¤‡ç®¡ç†æœåŠ¡å¯åŠ¨æˆåŠŸï¼`

**éªŒè¯**:
```bash
curl http://localhost:8081/device/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "Device Service is running"
}
```

**æ–¹å¼2ï¼šæ‰“åŒ…åè¿è¡Œï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰**

```bash
cd backend/device-service
mvn clean package
java -jar target/device-service-1.0.0.jar
```

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨è™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨

**åœ¨æ–°ç»ˆç«¯çª—å£ä¸­è¿è¡Œ**:

```bash
cd device-simulator

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æ¨¡æ‹Ÿå™¨
python device_simulator.py
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š
```
============================================================
W601è™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨
è®¾å¤‡ID: W601_001
MQTTæœåŠ¡å™¨: localhost:1883
============================================================

[2024-01-01 10:00:00] âœ… æˆåŠŸè¿æ¥åˆ°MQTTæœåŠ¡å™¨
[2024-01-01 10:00:00] ğŸ“¡ å·²è®¢é˜…æ§åˆ¶å‘½ä»¤ä¸»é¢˜
[2024-01-01 10:00:00] ğŸš€ æ¨¡æ‹Ÿå™¨å·²å¯åŠ¨ï¼Œæ¯30ç§’ä¸ŠæŠ¥ä¸€æ¬¡æ•°æ®
```

## åŠŸèƒ½éªŒè¯

### 1. æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨

```bash
curl http://localhost:8081/device/list
```

### 2. è·å–æœ€æ–°ä¼ æ„Ÿå™¨æ•°æ®

```bash
curl http://localhost:8081/device/W601_001/latest
```

### 3. æ‰‹åŠ¨æ§åˆ¶è®¾å¤‡

**å¼€ç¯**:
```bash
curl -X POST http://localhost:8081/device/control \
  -H "Content-Type: application/json" \
  -d '{"deviceId":"W601_001","action":"rgb_on"}'
```

**å…³ç¯**:
```bash
curl -X POST http://localhost:8081/device/control \
  -H "Content-Type: application/json" \
  -d '{"deviceId":"W601_001","action":"rgb_off"}'
```

è§‚å¯Ÿè™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨çš„è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°æ§åˆ¶å‘½ä»¤çš„å“åº”ã€‚

### 4. æµ‹è¯•è‡ªåŠ¨æ§åˆ¶é€»è¾‘

è‡ªåŠ¨æ§åˆ¶é€»è¾‘ä¼šæ ¹æ®å…‰ç…§å€¼è‡ªåŠ¨å¼€å…³ç¯ï¼š

- å½“å…‰ç…§ < 300 lux æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å‘é€å¼€ç¯å‘½ä»¤
- å½“å…‰ç…§ > 350 lux æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å‘é€å…³ç¯å‘½ä»¤

ç­‰å¾…æ¨¡æ‹Ÿå™¨ä¸ŠæŠ¥å‡ æ¬¡æ•°æ®ï¼Œè§‚å¯Ÿæ—¥å¿—ã€‚

### 5. æµ‹è¯•ç«ç¾å‘Šè­¦

ä¿®æ”¹ `device-simulator/device_simulator.py` æ–‡ä»¶ï¼š

```python
self.flame_detected = False  # æ”¹ä¸º True
```

é‡å¯æ¨¡æ‹Ÿå™¨ï¼Œä¼šç«‹å³è§¦å‘ç«ç¾å‘Šè­¦ã€‚

æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
æ£€æµ‹åˆ°ç«ç„°ï¼Œå·²è§¦å‘èœ‚é¸£å™¨ï¼deviceId=W601_001
```

æŸ¥è¯¢å‘Šè­¦è®°å½•ï¼š
```bash
curl http://localhost:8081/alarm/list
```

## æŸ¥çœ‹å®æ—¶æ•°æ®

### ä½¿ç”¨MQTTXå·¥å…·

1. ä¸‹è½½MQTTXï¼šhttps://mqttx.app/
2. åˆ›å»ºè¿æ¥ï¼š
   - Name: Smart Office
   - Host: localhost
   - Port: 1883
3. è®¢é˜…ä¸»é¢˜ï¼š`office/sensor/data`
4. è§‚å¯Ÿå®æ—¶æ•°æ®

### ä½¿ç”¨EMQ Xç®¡ç†ç•Œé¢

1. è®¿é—®ï¼šhttp://localhost:18083
2. ç™»å½•ï¼šadmin / public
3. è¿›å…¥ "WebSocket" å·¥å…·
4. è®¢é˜… `office/sensor/data` ä¸»é¢˜

## ç³»ç»Ÿæ¶æ„éªŒè¯

ç°åœ¨ä½ çš„ç³»ç»Ÿåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```
[è™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨]
     â†“ (MQTT: office/sensor/data)
[EMQ X MQTTæœåŠ¡å™¨]
     â†“
[è®¾å¤‡ç®¡ç†æœåŠ¡]
     â†“
[MySQLæ•°æ®åº“] + [Redisç¼“å­˜]
```

## å¸¸è§é—®é¢˜

### 1. DockeræœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :1883
netstat -ano | findstr :3306
netstat -ano | findstr :6379
```

### 2. åç«¯æœåŠ¡æ— æ³•è¿æ¥æ•°æ®åº“

æ£€æŸ¥é…ç½®æ–‡ä»¶ `backend/device-service/src/main/resources/application.yml`ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/smart_office
    username: root
    password: 123456  # ç¡®ä¿å¯†ç æ­£ç¡®
```

### 3. MQTTè¿æ¥å¤±è´¥

```bash
# æµ‹è¯•MQTTæœåŠ¡å™¨
docker exec -it smart-office-emqx emqx_ctl status
```

### 4. æ¨¡æ‹Ÿå™¨æ— æ³•è¿æ¥

æ£€æŸ¥ `device_simulator.py` ä¸­çš„é…ç½®ï¼š
```python
broker="localhost"  # å¦‚æœæ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œä¿®æ”¹ä¸ºæœåŠ¡å™¨IP
port=1883
```

## åœæ­¢æœåŠ¡

### åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
# åœæ­¢åç«¯ï¼ˆCtrl+Cï¼‰
# åœæ­¢æ¨¡æ‹Ÿå™¨ï¼ˆCtrl+Cï¼‰

# åœæ­¢DockeræœåŠ¡
cd docker
docker-compose down
```

### åœæ­¢å¹¶åˆ é™¤æ•°æ®

```bash
cd docker
docker-compose down -v
```

## ä¸‹ä¸€æ­¥

- ğŸ“– é˜…è¯» [APIæ–‡æ¡£](docs/API.md)
- ğŸ”§ é˜…è¯» [W601æ¥å…¥æŒ‡å—](docs/W601æ¥å…¥æŒ‡å—.md)
- ğŸ¨ å¼€å‘å‰ç«¯ç•Œé¢ï¼ˆVueï¼‰
- ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## å¼€å‘å»ºè®®

### 1. å¼€å‘åç«¯æ—¶

ä½¿ç”¨IDEï¼ˆIntelliJ IDEA / Eclipseï¼‰æ‰“å¼€ `backend` ç›®å½•ï¼Œé…ç½®å¥½Mavenåå¯ä»¥ç›´æ¥è¿è¡Œ `DeviceServiceApplication`ã€‚

### 2. è°ƒè¯•MQTTæ¶ˆæ¯

ä½¿ç”¨MQTTXå·¥å…·å¯ä»¥ï¼š
- è®¢é˜…ä¸»é¢˜æŸ¥çœ‹æ¶ˆæ¯
- æ‰‹åŠ¨å‘é€æµ‹è¯•æ¶ˆæ¯
- éªŒè¯æ¶ˆæ¯æ ¼å¼

### 3. æ•°æ®åº“ç®¡ç†

æ¨èå·¥å…·ï¼š
- Navicat
- DBeaver
- MySQL Workbench

è¿æ¥ä¿¡æ¯ï¼š
- Host: localhost
- Port: 3306
- Username: root
- Password: 123456
- Database: smart_office

### 4. æŸ¥çœ‹Redisç¼“å­˜

```bash
# è¿›å…¥Rediså®¹å™¨
docker exec -it smart-office-redis redis-cli -a redis123

# æŸ¥çœ‹æ‰€æœ‰key
KEYS *

# æŸ¥çœ‹æŸä¸ªkeyçš„å€¼
GET sensor:latest:W601_001
```

## æ€§èƒ½æµ‹è¯•

### æ¨¡æ‹Ÿå¤šä¸ªè®¾å¤‡

ä¿®æ”¹ `device_simulator.py`ï¼Œåˆ›å»ºå¤šä¸ªå®ä¾‹ï¼š

```python
# å¯åŠ¨3ä¸ªæ¨¡æ‹Ÿå™¨
python device_simulator.py &  # W601_001
# ä¿®æ”¹device_idåå†è¿è¡Œ
python device_simulator.py &  # W601_002
python device_simulator.py &  # W601_003
```

### å‹åŠ›æµ‹è¯•

ä½¿ç”¨ Apache JMeter æˆ– wrk å¯¹APIæ¥å£è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. å‚è€ƒå„æ¨¡å—çš„READMEæ–‡æ¡£
4. æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„ README.md
